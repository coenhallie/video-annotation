<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Shared Comments</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .test-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
      }
      .test-description {
        color: #666;
        margin-bottom: 15px;
      }
      .status {
        padding: 5px 10px;
        border-radius: 4px;
        display: inline-block;
        font-weight: bold;
      }
      .status.pass {
        background: #d4edda;
        color: #155724;
      }
      .status.fail {
        background: #f8d7da;
        color: #721c24;
      }
      .status.pending {
        background: #fff3cd;
        color: #856404;
      }
      .code-block {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 14px;
      }
      .comment-pill {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        background: #f3f4f6;
        color: #374151;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        margin-left: 8px;
      }
      .comment-icon {
        width: 12px;
        height: 12px;
        margin-right: 4px;
      }
      .new-indicator {
        width: 8px;
        height: 8px;
        background: #ef4444;
        border-radius: 50%;
        display: inline-block;
        margin-left: 4px;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <h1>Shared Project Comments - Test Suite</h1>

    <div class="test-section">
      <div class="test-title">Test 1: Comment Count Display</div>
      <div class="test-description">
        Verify that comment counts are displayed immediately when loading a
        shared project, without needing to manually click on the comments
        button.
      </div>
      <div class="code-block">
        // Expected behavior:<br />
        1. Share a project with annotations that have comments<br />
        2. Open the shared link<br />
        3. Comment counts should be visible in the annotation cards immediately
      </div>
      <div>
        Example display:
        <span class="comment-pill">
          <svg class="comment-icon" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
              clip-rule="evenodd"
            />
          </svg>
          3
        </span>
      </div>
      <div style="margin-top: 10px">
        Status: <span class="status pending">To be tested</span>
      </div>
    </div>

    <div class="test-section">
      <div class="test-title">Test 2: New Comment Indicator</div>
      <div class="test-description">
        Verify that the new comment indicator (red dot) appears immediately when
        a new comment is added to an annotation, without needing to expand the
        comments section first.
      </div>
      <div class="code-block">
        // Expected behavior:<br />
        1. Open a shared project<br />
        2. Another user adds a comment to an annotation<br />
        3. Red indicator dot should appear immediately next to the comment count
      </div>
      <div>
        Example display:
        <span class="comment-pill">
          <svg class="comment-icon" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
              clip-rule="evenodd"
            />
          </svg>
          4
          <span class="new-indicator"></span>
        </span>
      </div>
      <div style="margin-top: 10px">
        Status: <span class="status pending">To be tested</span>
      </div>
    </div>

    <div class="test-section">
      <div class="test-title">Test 3: Real-time Comment Updates</div>
      <div class="test-description">
        Verify that comment counts update in real-time when comments are added
        or removed, using the WebSocket subscription to Supabase.
      </div>
      <div class="code-block">
        // Expected behavior:<br />
        1. Open shared project in two browser windows<br />
        2. Add a comment in window 1<br />
        3. Comment count should update immediately in window 2<br />
        4. New comment indicator should appear in window 2
      </div>
      <div style="margin-top: 10px">
        Status: <span class="status pending">To be tested</span>
      </div>
    </div>

    <div class="test-section">
      <div class="test-title">Test 4: Comparison Video Comments</div>
      <div class="test-description">
        Verify that comment counts work correctly for shared comparison videos,
        including annotations from both videos and comparison-specific
        annotations.
      </div>
      <div class="code-block">
        // Expected behavior:<br />
        1. Share a comparison video project<br />
        2. Open the shared link<br />
        3. All annotations should show correct comment counts<br />
        4. Comments should be functional for all annotation types
      </div>
      <div style="margin-top: 10px">
        Status: <span class="status pending">To be tested</span>
      </div>
    </div>

    <h2>Implementation Summary</h2>
    <div class="test-section">
      <div class="test-title">Changes Made</div>
      <ul>
        <li>
          <strong>ShareService.ts:</strong> Modified to use
          AnnotationService.getVideoAnnotations() with includeCommentCounts=true
        </li>
        <li>
          <strong>Single Videos:</strong> Now fetch annotations with comment
          counts when loading shared videos
        </li>
        <li>
          <strong>Comparison Videos:</strong> Now fetch annotations with comment
          counts for both individual videos and comparison-specific annotations
        </li>
        <li>
          <strong>Fallback:</strong> If fetching with comment counts fails,
          falls back to basic annotation fetch
        </li>
      </ul>
    </div>

    <div class="test-section">
      <div class="test-title">Testing Instructions</div>
      <ol>
        <li>Create a video project with multiple annotations</li>
        <li>Add comments to some annotations</li>
        <li>Share the project using the share button</li>
        <li>Open the shared link in an incognito window</li>
        <li>Verify that comment counts are visible immediately</li>
        <li>Add a new comment (as anonymous or logged in)</li>
        <li>Verify that the new comment indicator appears</li>
        <li>Test the same flow with a comparison video</li>
      </ol>
    </div>

    <script>
      console.log(
        'Test page loaded. Please follow the testing instructions to verify the fixes.'
      );
    </script>
  </body>
</html>
